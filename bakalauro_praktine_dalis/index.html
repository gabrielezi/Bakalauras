<html>

<head>
    <meta charset="utf-8">
    <title>Blockly-gamepad demo</title>

    <link rel="stylesheet" type="text/css" href="css/style.css">
    

    <!--Blockly-->
    <script src="libs/blockly/blockly_compressed.js"></script>
    <script src="libs/blockly/blocks_compressed.js"></script>
    <script src="libs/blockly/javascript_compressed.js"></script>
    <script src="libs/blockly/en.js"></script>
    <script src="js/customBlocks.js"></script>
    

    <!--blockly-gamepad-->
    <script src="libs/gamepad/gamepad.min.js"></script>
</head>

<body>
    <header>
        <!--title-->
        <span class="title">
            <div>
                <a href="https://developers.google.com/blockly/">Blockly</a> 
                <a> Užduočių labirintas</a>
            </div>
        </span>
        <vr></vr>
        <!--level buttons-->
        <span class="switch_span">Lygiai</span>
        <button class="button level" id="level_1">1</button>
        <button class="button level" id="level_2">2</button>
        <button class="button level" id="level_3">3</button>
        <button class="button level" id="level_4">4</button>
        <button class="button level" id="level_5">5</button>
        <button class="button level" id="level_6">6</button>
        <button class="button level" id="level_7">7</button>
        <button class="button level" id="level_8">8</button>
        <button class="button level" id="level_9">...</button>
        <vr></vr>
        
        <div>Taškai:  </div>
        <div id="points">0</div>

    </header>

    <main>
        <!--game div-->
        <div id="game-div">
            <!--game 1-->
            <svg xmlns="http://www.w3.org/2000/svg" style="display: none" version="1.1" id="1" width="400px"
                height="400px" viewBox="0 0 400 400">
                <image xlink:href="images/maze1.png" class="maze" x="0" y="-1" width="400" height="399"></image>
                <image id="finish1" xlink:href="images/marker.png" height="34" width="20" x="215" y="146"></image>
                <text id="task1" x="168" y="180" fill="red" font-weight="bold">2+3</text>
                <clipPath id="pegmanClipPath1">
                    <rect id="clipRect1" width="49" height="52" x="101" y="191"></rect>
                </clipPath>
                <image id="pegman1" xlink:href="images/pegman.png" height="52" width="1029"
                    clip-path="url(#pegmanClipPath1)" x="-95" y="191" transform="rotate(0, 0, 0)"></image>
            </svg>
            <!--game 2-->
            <svg xmlns="http://www.w3.org/2000/svg" style="display: none" version="1.1" id="2" width="400px"
                height="400px" viewBox="0 0 400 400">
                <image xlink:href="images/maze2.png" class="maze" x="0" y="0" width="400" height="400"></image>
                <image id="finish2" xlink:href="images/marker.png" height="34" width="20" x="315" y="196"></image>
                <clipPath id="2pegmanClipPath">
                    <rect id="clipRect2" width="49" height="52" x="101" y="191"></rect>
                </clipPath>
                <image id="pegman2" xlink:href="images/pegman.png" height="52" width="1029"
                    clip-path="url(#2pegmanClipPath)" x="-145" y="191" transform="rotate(0, 0, 0)"></image>
            </svg>
            <!--game 3-->
            <svg xmlns="http://www.w3.org/2000/svg" style="display: none" version="1.1" id="3" width="400px"
                height="400px" viewBox="0 0 400 400">
                <image xlink:href="images/maze3.png" class="maze" x="0" y="0" width="400" height="400"></image>
                <image id="finish3" xlink:href="images/marker.png" height="34" width="20" x="265" y="46"></image>
                <text id="task1" x="253" y="330" fill="red" font-weight="bold">23+74</text>
                <clipPath id="3pegmanClipPath">
                    <rect id="clipRect3" width="49" height="52" x="51" y="291"></rect>
                </clipPath>
                <image id="pegman3" xlink:href="images/pegman.png" height="52" width="1029"
                    clip-path="url(#3pegmanClipPath)" x="-95" y="191" transform="rotate(0, 0, 0)"></image>
            </svg>
            <!--game 4-->
            <svg xmlns="http://www.w3.org/2000/svg" style="display: none" version="1.1" id="4" width="400px"
                height="400px" viewBox="0 0 400 400">
                <image xlink:href="images/maze4.png" class="maze" x="0" y="0" width="400" height="400"></image>
                <image id="finish4" xlink:href="images/marker.png" height="34" width="20" x="265" y="96"></image>
                <text id="task1" x="167" y="230" fill="red" font-weight="bold">6*5</text>
                <clipPath id="4pegmanClipPath">
                    <rect id="clipRect4" width="49" height="52" x="51" y="291"></rect>
                </clipPath>
                <image id="pegman4" xlink:href="images/pegman.png" height="52" width="1029"
                    clip-path="url(#4pegmanClipPath)" x="-145" y="291" transform="rotate(0, 0, 0)"></image>
            </svg>
            <!--game 5-->
            <svg xmlns="http://www.w3.org/2000/svg" style="display: none" version="1.1" id="5" width="400px"
                height="400px" viewBox="0 0 400 400">
                <image xlink:href="images/maze5.png" class="maze" x="0" y="0" width="400" height="400"></image>
                <image id="finish5" xlink:href="images/marker.png" height="34" width="20" x="165" y="195"></image>
                <text id="task1" x="165" y="130" fill="red" font-weight="bold" class="hoverTask">??</text>
                <text class="hide" x="80" y="113">Kokia planeta yra vadinama „raudonąja"?</text>
                <clipPath id="5pegmanClipPath">
                    <rect id="clipRect5" width="49" height="52" x="51" y="291"></rect>
                </clipPath>
                <image id="pegman5" xlink:href="images/pegman.png" height="52" width="1029"
                    clip-path="url(#5pegmanClipPath)" x="-145" y="291" transform="rotate(0, 0, 0)"></image>
            </svg>
            <!--game 6-->
            <svg xmlns="http://www.w3.org/2000/svg" style="display: none" version="1.1" id="6" width="400px"
                height="400px" viewBox="0 0 400 400">
                <image xlink:href="images/maze6.png" class="maze" x="0" y="0" width="400" height="400"></image>
                <image id="finish6" xlink:href="images/marker.png" height="34" width="20" x="265" y="295"></image>
                <text id="task1" x="165" y="130" fill="red" font-weight="bold" class="hoverTask">??</text>
                <text class="hide" x="80" y="113">Kokia yra vandens užšalimo temperatūra?</text>
                <clipPath id="6pegmanClipPath">
                    <rect id="clipRect6" width="49" height="52" x="51" y="291"></rect>
                </clipPath>
                <image id="pegman6" xlink:href="images/pegman.png" height="52" width="1029"
                    clip-path="url(#6pegmanClipPath)" x="-145" y="291" transform="rotate(0, 0, 0)"></image>
            </svg>
            <!--game 7-->
            <svg xmlns="http://www.w3.org/2000/svg" style="display: none" version="1.1" id="7" width="400px"
                height="400px" viewBox="0 0 400 400">
                <image xlink:href="images/maze7.png" class="maze" x="0" y="0" width="400" height="400"></image>
                <image id="finish7" xlink:href="images/marker.png" height="34" width="20" x="15" y="145"></image>
                <text id="task1" x="117" y="130" fill="red" font-weight="bold" class="hoverTask">??-Neprivalomas</text>
                <text class="hide" x="20" y="113">Kiek laipsnių sudaro visų trikampio vidinių kampų suma?</text>
                <text id="task1" x="315" y="180" fill="red" font-weight="bold" class="hoverTask">??</text>
                <text class="hide" x="140" y="160">Kiek gramų sudaro 1000 kilogramų?</text> 
                <clipPath id="7pegmanClipPath">
                    <rect id="clipRect7" width="49" height="52" x="51" y="291"></rect>
                </clipPath>
                <image id="pegman7" xlink:href="images/pegman.png" height="52" width="1029"
                    clip-path="url(#7pegmanClipPath)" x="-145" y="291" transform="rotate(0, 0, 0)"></image>
            </svg>
            <!--game 8-->
            <svg xmlns="http://www.w3.org/2000/svg" style="display: none" version="1.1" id="8" width="400px"
                height="400px" viewBox="0 0 400 400">
                <image xlink:href="images/maze8.png" class="maze" x="0" y="0" width="400" height="400"></image>
                <image id="finish8" xlink:href="images/marker.png" height="34" width="20" x="215" y="46"></image>
                <text id="task1" x="160" y="230" fill="red" font-weight="bold">23*4</text>
                <text id="task1" x="258" y="130" fill="red" font-weight="bold">15*7</text>
                <clipPath id="8pegmanClipPath">
                    <rect id="clipRect8" width="49" height="52" x="51" y="291"></rect>
                </clipPath>
                <image id="pegman8" xlink:href="images/pegman.png" height="52" width="1029"
                    clip-path="url(#8pegmanClipPath)" x="-145" y="291" transform="rotate(0, 0, 0)"></image>
            </svg>
            <!--game 9------------------------------------------------------------------------------------------------------->
            <canvas style="display: none" ></canvas>
            
                <svg xmlns="http://www.w3.org/2000/svg"  style="display: none" version="1.1"  id="9" width="360px"
                height="360px" viewBox="0 0 360 360">
                    <image id="randomMazeImg" class="maze" x="0" y="0"  width="360" height="360"></image>
                    <defs >
                        <pattern class="moveGrid" x="12" y="12" id="smallGrid" width="48" height="48" patternUnits="userSpaceOnUse">
                            <path d="M 48 0 L 0 0 0 48" fill="none" stroke="gray" stroke-width="0.5" />
                        </pattern>
                        <pattern class="moveGrid"  id="grid" width="78" height="78" patternUnits="userSpaceOnUse">
                            <rect width="78" height="78" fill="url(#smallGrid)" />
                            <path d="M 78 0 L 0 0 0 78" fill="none" stroke="gray" stroke-width="1" />
                        </pattern>
                    </defs>
                
                    <rect width="100%" height="100%" fill="url(#smallGrid)" />
                    <image id="finish9" xlink:href="images/marker.png" height="34" width="20" x="75" y="55"></image> <!--x="27" y="15" ----x="75" y="55"---->
                    <text id="task9" x="75" y="170" fill="red" font-weight="bold" class="hoverTask">??</text><!--x="25" y="40"-- x="75" y="80" s-->
                    <text id="task9Question" class="hide" x="140" y="160">2+2</text> 
                    <clipPath id="9pegmanClipPath">
                        <rect id="clipRect9" width="49" height="52" x="51" y="291"></rect>
                    </clipPath>
                    <image id="pegman9" xlink:href="images/pegman.png" height="52" width="1029"
                        clip-path="url(#9pegmanClipPath)" x="-145" y="291" transform="rotate(0, 0, 0)"></image>
                        
                </svg>
                
            <!--capacity div-->
            <div id="capacity" style="display: none;">Liko blokelių: <span id="capacityNumber">10</span></div>
            <!--buttons-->
            <div class="buttons">
                <button id="play" class="button green" style="grid-area: 1">Žaisti</button>
                <button id="pause" class="button green" style="grid-area: 2">Sustabdyti</button>
                <hr>
                <button id="forward" class="button blue" style="grid-area: 2">Į priekį</button>
                <button id="backward" class="button blue" style="grid-area: 3">Atgal</button>
                <hr>
                <button class="button violet" style="grid-area: 1" id="info">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-info-circle" id="svgCornerTR" viewBox="0 0 16 16" class="hoverTask">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
                    </svg>
                </button>
                <hr>
                <div id="newLevelDiv" style="display: none;font-family: sans-serif;">
                    <form style="margin-top: 5px;" id="formBlocks">
                    Blokelių skaičius:
                    <select id="selectForm">
                      <option id="two">2</option>
                      <option id="three">3</option>
                      <option id="four">4</option>
                      <option id="five">5</option>
                      <option id="six">6</option>
                      <option id="seven" selected>7</option>
                      <option id="eight">8</option>
                      <option id="nine">9</option>
                    </select>
                  </form>
                <button id="randomButton" class="button blue" style=" background-color: rgb(168, 209, 177); ">NAUJAS LYGIS</button>
                </div>
            </div>
            
            
        </div>
        
        <div id="myModal" class="modal">
            <!-- Modal content -->
            <div class="modal-content">
              <span class="close">&times;</span>
              <h2>Padėk žmogėliukui pasiekti savo tikslą!</h2>
              <ul>
                <li>
                    <p>Tempk blokelius vieną po kito:</p>
                    <img src="images/blocks_gif.gif" alt="Put the blocks in order">
                </li>
                <li>
                    <p>Atsakymą įrašyk "Atsakymas yra _" blokelyje ir padėk jį toje sekos vietoje, kur manai, jog žmogeliukas užlipa ant užduoties laukelio:</p>
                    <img src="images/atsakymas.png" alt="Atsakymo pozicija">
                </li>
                <li>
                    <p>Pamačius klaustukus žemėlapyje užvilk ant jų pelę - pamatysi klausimą:</p>
                    <img src="images/question.gif" alt="Question">
                </li>
                <li>
                    <p>Kad paleistum savo sukurtą seką, spausk "Žaisti":</p>
                    <img src="images/buttons.png" alt="Start button">
                </li>
                <li>
                    <p>Paleidus žaidimą gali eiti žingsnis po žingsnio per savo seką, sustabdžius veikėją ("Sustabdyti") ir spaudžiant "Į priekį":</p>
                    <img src="images/iPrieki.png" alt="Step by step button">
                </li>
                <li>
                    <p>Savo taškus gali matyti viršuje!  	&uarr;:</p>
                    <img src="images/taskai.png" alt="Your points">
                </li>
                <li>
                    <p>Lygyje, pažymėtame daugtaškiu galima generuoti naujus labirintus ir užduotis pagal pasirinktą blokelių skaičių</p>
                    <img src="images/randomLevel.png" alt="Random Level Button">
                    <p>Paspaudus ant šio mygtuko pasirodo tuščias žemėlapis, o sugeneruoti labirintą galima apačioje pasirinkus blokelių skaičių ir paspaudus "Naujas lygis"</p>
                    <img src="images/generateLevel.png" alt="Generate new level">
                </li>
              </ul>
            </div>
          
          </div>
        <!--workspace div-->
        <div id="blockly-editor">
            <div id="blockly-div"></div>
            <!--toolbox without categories-->
            <xml id="toolbox" style="display: none">
                <block type="move"></block>
                <block type="turn"></block>
                <block type="turn">
                    <field name="DIRECTION">3</field>
                </block>
                <block type="repeat_until"></block>
                <block type="if_path"></block>
                <block type="if_path_only_answer"></block>
                <block type="if_else_path"></block>
                <block type="answerBlock"></block>
            </xml>
            <!--toolbox whit categories-->
            <xml id="toolbox_c" style="display: none">
                <category name="Controls" colour="285">
                    <block type="move"></block>
                    <block type="turn"></block>
                    <block type="answerBlock"></block>
                    <block type="turn">
                        <field name="DIRECTION">3</field>
                    </block>
                </category>
                <category name="Logic" colour="120">
                    <block type="repeat_until"></block>
                    <block type="if_path"></block>
                    <block type="if_else_path"></block>
                </category>
            </xml>
        </div>
    </main>

    <!--load global parameters-->
    <script>
        // get parameters in url
        function getUrlVars() {
            var vars = {};
            var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
                vars[key] = value;
            });
            return vars;
        }

        // global vars
        let {
            start,
            categories,
            id
        } = getUrlVars()

        // update parameters
        start = start != undefined
        categories = categories != undefined
        // id = (id == '1') ? 0 : 1
        id = parseInt(id)

        // update the checkers
        if (start) document.getElementById('start_check').checked = true
        if (categories) document.getElementById('categories_check').checked = true

        // set the toolbox
        const toolbox = document.getElementById(categories ? 'toolbox_c' : 'toolbox')
    </script>

    <!--scripts-->
    <script src="js/levels.js"></script>
    <script src="js/gui.js"></script>
    <script src="js/game.js"></script>
    <script src="js/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/underscore@1.13.1/underscore-umd-min.js"></script>
    <script src="js/blocks.js"></script>
    <script src="js/maze.js"></script>
    <script src="js/shortestPath.js"></script>

    <!--link event to buttons-->
    <script>
        // Get the modal
        var modal = document.getElementById("myModal");

        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        // link the buttons
        // document.getElementById('load').onclick = () => game.loadCode() + console.clear()
        document.getElementById('info').onclick = () =>{
            modal.style.display = "block";
        }
        span.onclick = function() {
        modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
        var wid = window.innerWidth;
        document.getElementById("myModal").style.width = wid-639;

        document.getElementById('level_1').onclick = () => game.loadLevel(levels[id = 0]) + console.clear()
        document.getElementById('level_2').onclick = () => game.loadLevel(levels[id = 1]) + console.clear()
        document.getElementById('level_3').onclick = () => game.loadLevel(levels[id = 2]) + console.clear()
        document.getElementById('level_4').onclick = () => game.loadLevel(levels[id = 3]) + console.clear()
        document.getElementById('level_5').onclick = () => game.loadLevel(levels[id = 4]) + console.clear()
        document.getElementById('level_6').onclick = () => game.loadLevel(levels[id = 5]) + console.clear()
        document.getElementById('level_7').onclick = () => game.loadLevel(levels[id = 6]) + console.clear()
        document.getElementById('level_8').onclick = () => game.loadLevel(levels[id = 7]) + console.clear()
        document.getElementById('level_9').onclick = () =>{
            game.loadLevel(levels[id = 8]) + console.clear();
            document.getElementById('newLevelDiv').style.display = "block";
        }

        document.getElementById('forward').onclick = () => gamepad.forward() + gui.removeAnimation()
        document.getElementById('backward').onclick = () => gamepad.backward() + gui.removeAnimation()
        document.getElementById('play').onclick = () =>{
            game.loadCode() + console.clear()
            gamepad.play()
        } 
        document.getElementById('pause').onclick = () => gamepad.pause()
    </script>
    

    <!--remaining block-->
    <script>
        // update remaining block
        Blockly.getMainWorkspace().addChangeListener(() => {
            let capacity = Blockly.getMainWorkspace().remainingCapacity()
            if (capacity != Infinity) {
                // show capacity div
                document.getElementById('capacity').style.display = 'block'
                document.getElementById('capacityNumber').innerHTML = capacity
            } else {
                // hide capacity div
                document.getElementById('capacity').style.display = 'none'
            }
        })
        
    </script>

    <!--navigation-->
    <script>
        // get the url
        const getUrl = (start, categories) => {
            let url = []

            if (start) url.push('start=true')
            if (categories) url.push('categories=true')
            url.push('id=' + (id + 1))

            return 'index.html?' + url.join('&')
        }

        // add handlers
        document.getElementById('start_check').onclick =
            (event) => window.location.href = getUrl(event.target.checked, categories)

        document.getElementById('categories_check').onclick =
            (event) => window.location.href = getUrl(start, event.target.checked)

        // show capacity div
        if (id == 2) document.getElementById('capacity').style.display = 'block'
    </script>

</body>

</html>